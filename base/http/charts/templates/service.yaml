{{- $HTTPContainerPorts := regexSplit "~+" .Values.HTTPTargetPorts -1 }}
{{- $HTTPSContainerPorts := regexSplit "~+" .Values.HTTPSTargetPorts -1 }}
{{- if or .Values.HTTPPorts .Values.HTTPSPorts }}
apiVersion: v1
kind: Service
metadata:
  name: s{{.Values.version}}
  labels:
    app: s{{.Values.version}}
spec:
  selector:
    app: p{{.Values.version}}
  ports:
    {{- if .Values.HTTPPorts }}
    {{- range $index,$value := regexSplit "~+" .Values.HTTPPorts -1 }}
    - protocol: TCP
      port: {{ $value | int }}
      targetPort: {{ index $HTTPContainerPorts $index }}
      name: HTTP-{{ $value }}
    {{- end }}
    {{- end }}
    {{- if .Values.HTTPSPorts }}
    {{- range $index,$value := regexSplit "~+" .Values.HTTPSPorts -1 }}
    - protocol: TCP
      port: {{ $value | int }}
      targetPort: {{ index $HTTPSContainerPorts $index }}
      name: HTTPS-{{ $value }}
    {{- end }}
    {{- end }}
  type: LoadBalancer
{{- end }}